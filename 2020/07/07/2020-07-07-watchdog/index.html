<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>watchdog | 所念皆星辰</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="灾难总是接踵而至，这正是世间的常理。只要找个理由，就会有谁来救你吗？要是死了，就只是说明我不过是如此程度的男人。">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="watchdog | 所念皆星辰">
    <meta name="twitter:description" content="灾难总是接踵而至，这正是世间的常理。只要找个理由，就会有谁来救你吗？要是死了，就只是说明我不过是如此程度的男人。">

    <meta property="og:type" content="article">
    <meta property="og:title" content="watchdog | 所念皆星辰">
    <meta property="og:description" content="灾难总是接踵而至，这正是世间的常理。只要找个理由，就会有谁来救你吗？要是死了，就只是说明我不过是如此程度的男人。">

    
    <meta name="author" content="GUOHUA">
    
    <link rel="stylesheet" href="/css/vno.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    
    <link rel="icon" href="/images/avatar-small.png">
    

    <meta name="generator" content="hexo"/>
    
    <link rel="alternate" type="application/rss+xml" title="所念皆星辰" href="/atom.xml">
    

    <link rel="canonical" href="https://qinguohua.fun/2020/07/07/2020-07-07-watchdog/"/>

    
      
</head>

<body class="home-template no-js">
    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url()">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="前往 所念皆星辰 的主页"><img src="/images/avatar.png" width="80" alt="所念皆星辰 logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for 所念皆星辰">所念皆星辰</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">踏实、低调、前行。</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">简单的一个技术博客，用来作为学习笔记和日常记录使用。</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="访问博客" class="blog-button">博客</a></li>
            
              <li class="navigation__item"><a href="/archives">archives</a></li>
            
              <li class="navigation__item"><a href="/categories">随笔</a></li>
            
              <li class="navigation__item"><a href="/about">关于</a></li>
            
              <li class="navigation__item"><a href="/tags">tag</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  

  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/guohuaCabin" title="wheat的GitHub主页" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- jianshu -->
  

<!-- cnblogs -->
  

<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  

  <li class="navigation__item">
    <a href="/atom.xml" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>



  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-blue"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2020-07-07T14:44:50.000Z" class="post-list__meta--date date">2020-07-07</time> &#8226; <span class="post-meta__tags tags">于&nbsp;
  <a class="tag-link" href="/tags/watchdog/">watchdog</a>
 </span>
      <span class="page-pv">
      &nbsp;阅读&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
      </span> 
   
    </div>
    <h1 class="post-title">watchdog</h1>
  </header>

  <section class="post">
    <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>为了防止一个应用程序占用过多的系统资源，苹果设计一个监督机构 <code>watchdog</code> ,音译：<strong>看门狗机制。</strong></p>
<p>用户希望应用程序快速启动，并对触摸和手势做出响应。操作系统使用一个监督机构来监控启动时间和应用程序的响应，如果超出了该场景下所规定的运行时间，该机制就会终止无响应的应用程序。</p>
<p><code>watchdog</code> 完整的信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Exception Type:  EXC_CRASH (SIGKILL)</span><br><span class="line">Exception Codes: 0x0000000000000000, 0x0000000000000000</span><br><span class="line">Exception Note:  EXC_CORPSE_NOTIFY</span><br><span class="line">Termination Reason: Namespace SPRINGBOARD, Code 0x8badf00d</span><br><span class="line">Termination Description: SPRINGBOARD, &lt;RBSTerminateContext| domain:10 code:0x8BADF00D explanation:scene-update watchdog transgression: application&lt;com.kaike.online&gt;:745 exhausted real (wall clock) time allowance of 10.00 seconds | ProcessVisibility: Background | ProcessState: Running | WatchdogEvent: scene-update | WatchdogVisibility: Background | WatchdogCPUStatistics: ( | &quot;Elapsed total CPU time (seconds): 20.230 (user 20.230, system 0.000), 34% CPU&quot;, | &quot;Elapsed application CPU time (seconds): 0.001, 0% CPU&quot; | ) reportType:CrashLog maxTerminationResistance:Interactive&gt;</span><br><span class="line">Triggered by Thread:  0</span><br></pre></td></tr></table></figure>
<p>通俗讲：</p>
<p>为了避免应用陷入错误状态导致界面无响应，Apple 设计了 <code>watchdog</code> 机制。一旦超时，强制杀死进程。在不同的生命周期，触发 <code>watchdog</code> 机制的超时时间有所不同：</p>
<table>
<thead>
<tr>
<th style="text-align:center">生命周期</th>
<th style="text-align:center">超时时间</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">启动 Launch</td>
<td style="text-align:center">20s</td>
</tr>
<tr>
<td style="text-align:center">恢复 Resume</td>
<td style="text-align:center">10s</td>
</tr>
<tr>
<td style="text-align:center">悬挂 Suspend</td>
<td style="text-align:center">10s</td>
</tr>
<tr>
<td style="text-align:center">退出Quit</td>
<td style="text-align:center">6s</td>
</tr>
<tr>
<td style="text-align:center">后台 Background</td>
<td style="text-align:center">10min</td>
</tr>
</tbody>
</table>
<p><code>watchdog</code> 的终止使用崩溃报告的终止原因中的代码是 <code>0x8badf00d</code> （发音为“吃了不好的食物”）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Exception Type:  EXC_CRASH (SIGKILL)</span><br><span class="line">Exception Codes: 0x0000000000000000, 0x0000000000000000</span><br><span class="line">Exception Note:  EXC_CORPSE_NOTIFY</span><br><span class="line">Termination Reason: Namespace SPRINGBOARD, Code 0x8badf00d</span><br></pre></td></tr></table></figure>
<p><code>watchdog</code> 终止长时间阻塞主线程的应用程序。有很多方法可以延长阻塞主线程，例如：</p>
<ul>
<li>同步网络</li>
<li><p>处理大量数据</p>
</li>
<li><p>同步触发大型核心数据存储的轻量级迁移</p>
</li>
<li>使用Vision进行分析请求。</li>
</ul>
<h3 id="解读App响应式-watchdog-信息"><a href="#解读App响应式-watchdog-信息" class="headerlink" title="解读App响应式 watchdog 信息"></a>解读App响应式 <code>watchdog</code> 信息</h3><p>当应用程序启动或响应事件缓慢时，崩溃报告中的终止信息包含有关应用程序如何花费时间的重要信息。</p>
<h4 id="崩溃信息一"><a href="#崩溃信息一" class="headerlink" title="崩溃信息一"></a>崩溃信息一</h4><p>例如，卡顿时挂起App在崩溃报告中具有以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Termination Description: SPRINGBOARD, &lt;RBSTerminateContext| domain:10 code:0x8BADF00D explanation:scene-update watchdog transgression: application&lt;com.example.MyCoolApp&gt;:745 exhausted real (wall clock) time allowance of 10.00 seconds </span><br><span class="line">    | ProcessVisibility: Background </span><br><span class="line">    | ProcessState: Running </span><br><span class="line">    | WatchdogEvent: scene-update </span><br><span class="line">    | WatchdogVisibility: Background </span><br><span class="line">    | WatchdogCPUStatistics: ( </span><br><span class="line">    | &quot;Elapsed total CPU time (seconds): 20.230 (user 20.230, system 0.000), 34% CPU&quot;, </span><br><span class="line">    | &quot;Elapsed application CPU time (seconds): 0.001, 0% CPU&quot; </span><br><span class="line">    | )</span><br></pre></td></tr></table></figure>
<p>上述描述中可以看出：<code>WatchdogEvent</code> 是 <code>scene-update</code> ，说明应用程序是在<strong>场景更新</strong> 时终止的，原因是没有足够快地更新其UI，因为主线程太忙。</p>
<h4 id="崩溃信息二"><a href="#崩溃信息二" class="headerlink" title="崩溃信息二"></a>崩溃信息二</h4><p>在App启动后没有快速呈现UI，在崩溃报告中具有以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Termination Description: SPRINGBOARD, </span><br><span class="line">    scene-create watchdog transgression: application&lt;com.example.MyCoolApp&gt;:667</span><br><span class="line">    exhausted real (wall clock) time allowance of 19.97 seconds </span><br><span class="line">    | ProcessVisibility: Foreground </span><br><span class="line">    | ProcessState: Running </span><br><span class="line">    | WatchdogEvent: scene-create </span><br><span class="line">    | WatchdogVisibility: Foreground </span><br><span class="line">    | WatchdogCPUStatistics: ( </span><br><span class="line">    |  &quot;Elapsed total CPU time (seconds): 15.290 (user 15.290, system 0.000), 28% CPU&quot;, </span><br><span class="line">    |  &quot;Elapsed application CPU time (seconds): 0.367, 1% CPU&quot; </span><br><span class="line">    | )</span><br></pre></td></tr></table></figure>
<p>由<code>WatchdogEvent: scene-create</code> 可以看出是在<strong>场景创建</strong>时终止的，原因是没有在允许的启动时间内将UI的第一帧渲染到屏幕上。</p>
<h4 id="崩溃信息中的信息解析"><a href="#崩溃信息中的信息解析" class="headerlink" title="崩溃信息中的信息解析"></a>崩溃信息中的信息解析</h4><h5 id="1-1-Elapsed-total-CPU-time"><a href="#1-1-Elapsed-total-CPU-time" class="headerlink" title="1.1 Elapsed total CPU time"></a>1.1 Elapsed total CPU time</h5><p><code>Elapsed total CPU time</code> 显示CPU在挂钟时间内系统上的所有进程运行了多少时间。</p>
<p>此CPU时间以及应用程序CPU时间适用于跨CPU内核的总CPU利用率，可能超过100%。例如，如果一个CPU内核利用率为100%，第二个CPU内核利用率为20%，则总CPU利用率为120%。</p>
<h5 id="1-2-Elapsed-application-CPU-time"><a href="#1-2-Elapsed-application-CPU-time" class="headerlink" title="1.2 Elapsed application CPU time"></a>1.2 Elapsed application CPU time</h5><p><code>Elapsed application CPU time</code> 显示应用程序在挂钟时间内在CPU上运行所花费的时间。</p>
<p>如果此数字处于任一极端，则表明存在问题。如果数字很高，则应用程序正在其所有线程中执行大量工作（该数字聚合所有线程，并且不特定于主线程。）</p>
<p>如果此数字较低，则该应用程序大部分处于空闲状态，因为它正在等待系统资源，例如网络连接。</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><ul>
<li>异步请求</li>
<li><p>不要使用 <code>SCNetworkReachability</code>，而是使用 <code>NWPathMonitor</code> 在网络路径更改时接收更新。系统在您调用 <code>start</code>(<code>queue:</code>) 时传入的队列上提供更新，因此路径更新功能安全地脱离主线程。</p>
</li>
<li><p>在辅助线程中执行同步网络</p>
</li>
<li>大多数情况下不建议手动解析 <code>DNS</code>。使用 <code>URLSession</code> 让系统代表您处理 <code>DNS</code> 解析。如果切换非常困难，并且您仍然需要手动更改 <code>DNS</code> 地址，请使用异步 <code>API</code>，如 <code>CFHost</code> 或 中的 <code>API</code>。</li>
</ul>
<p><a href="https://developer.apple.com/documentation/xcode/addressing-watchdog-terminations#Interpret-the-App-Responsiveness-Watchdog-Information" target="_blank" rel="noopener">Addressing Watchdog Terminations</a></p>

  </section>

</article>
<section class="read-more">
           
    
               
            <div class="read-more-item">
                <span class="read-more-item-dim">最近的文章</span>
                <h2 class="post-list__post-title post-title"><a href="/2021/01/30/2019-01-30-Binary-Tree/" title="二叉树遍历（Binary Tree）">二叉树遍历（Binary Tree）</a></h2>
                <p class="excerpt">
                
                简介二叉树（Binary Tree）：计算机中数据结构的一种，是树形结构的一个重要类型。结构类型是每个节点最多有两个子树的树结构。特点是每个节点最多只能有了两棵子树，且有左右之分。
定义二叉树是指树中节点的度不大于2的有序树，是n(n&amp;gt;=0)个节点的有限集合，该集合或者为空集（称为空二叉树），
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2021-01-30T11:14:01.000Z" class="post-list__meta--date date">2021-01-30</time> &#8226; <span class="post-list__meta--tags tags">于&nbsp;
  <a class="tag-link" href="/tags/算法/">算法</a>
</span><a class="btn-border-small" href="/2021/01/30/2019-01-30-Binary-Tree/">继续阅读</a></div>
                           
            </div>
        
        
               
            <div class="read-more-item">
                <span class="read-more-item-dim">更早的文章</span>
                <h2 class="post-list__post-title post-title"><a href="/2019/04/20/2019-04-20-Arithmetic-weekly5/" title="算法：从尾到头打印链表">算法：从尾到头打印链表</a></h2>
                <p class="excerpt">
                
                从尾到头打印链表题：输入一个链表的头结点，从尾到头反过来打印出每个结点的值。链表结点定义如下：12345struct ListNode&amp;#123;   int   m_nKey;  ListNode* m_pNext;&amp;#125;
思路：我们首先想到的是链表的翻转，这也是我们的第一思路。但链表的翻转
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2019-04-20T12:46:09.000Z" class="post-list__meta--date date">2019-04-20</time> &#8226; <span class="post-list__meta--tags tags">于&nbsp;
  <a class="tag-link" href="/tags/Algorithm/">Algorithm</a>
</span><a class="btn-border-small" href="/2019/04/20/2019-04-20-Arithmetic-weekly5/">继续阅读</a></div>
                       
            </div>
        
     
   
   
  
</section>

            
            <br><footer class="footer">
    <span class="footer__copyright">听过无数道理，还是过不好这一生。那就随着心意任性地走吧，走累的时候再安营扎寨，或者永远也不。本人邮箱：wheatden@guohuaden.com
    </span>
   
</footer>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
        </div>
    </div>

    

     
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'GTM-NHB73SK', 'auto');
	ga('send', 'pageview');
</script>

    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?ae05530a6a007cdb8063cf611691cc3e";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>



    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
    
    </script>
    
</body>
</html>
